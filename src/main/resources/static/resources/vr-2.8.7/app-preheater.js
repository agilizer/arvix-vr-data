!function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return o(n?n:e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){(function(n){"use strict";var r=e("./util/logger"),o=e("./util/browser"),i=new r(n),a={init:function(e,t){t=t||{};var n=100*Math.random();o.valueFromHash("gzip")&&(t.gzip=1===o.valueFromHash("gzip",0)),o.valueFromHash("preheat")&&(t.preheat=1===o.valueFromHash("preheat",0)),o.valueFromHash("preheatmesh")&&(t.preheatMesh=1===o.valueFromHash("preheatmesh",0));for(var r in e){var s=r.match("^showcase_gzip_([0-9]+)$");s&&(a.gzip=n<parseInt(s[1]));var u=r.match("^showcase_preheat_([0-9]+)$");u&&(a.preheat=n<parseInt(u[1]));var c=r.match("^showcase_preheat_mesh_([0-9]+)$");c&&(a.preheatMesh=n<parseInt(c[1]))}for(var l in t)a[l]=t[l],i.debug("A/B override:",l,a[l])},gzip:!1,preheat:!1,preheatMesh:!1};t.exports=a}).call(this,"/js/ab.js")},{"./util/browser":11,"./util/logger":13}],2:[function(e,t,n){"use strict";t.exports={signedUrlRefreshRate:240,dollhouseFOV:60,dollhouseNear:1,dollhouseFar:500,insideFOV:60,insideNear:.1,insideFar:500,insideLookSpeed:.12,insideLookLimitUp:40,insideLookLimitDown:-40,orthoNear:1,orthoFar:500,orthoBase:10}},{}],3:[function(e,t,n){"use strict";t.exports={GL_TEXTURE_CUBE_MAP_POSITIVE_X:0,GL_TEXTURE_CUBE_MAP_NEGATIVE_X:1,GL_TEXTURE_CUBE_MAP_POSITIVE_Y:2,GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:3,GL_TEXTURE_CUBE_MAP_POSITIVE_Z:4,GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:5}},{}],4:[function(e,t,n){"use strict";function r(e){this.message=e}t.exports=r},{}],5:[function(e,t,n){(function(n){"use strict";function r(e){var t={};if(e){var n=e.flags;if(n)for(var r in n)n.hasOwnProperty(r)&&(t[n[r]]=!0);return t}return u.debug("Feature flags -> parseFeatureFlags: rawData is null."),null}var o=e("./util/ajax"),i=e("./util/showcase"),a=e("./util/logger"),s="/api/v1/user/",u=new a(n),c={};t.exports={loadFeatureFlags:function(e){var t=$.Deferred();return o.get(e.urlBase+s,{responseType:"json",prefetchFrom:"user",auth:i.getAuthorizationHeader()}).done(function(e){c=r(e),c?t.resolve(c):t.reject("loading-failed")}).fail(function(){u.debug("Retrieval of feature flags failed."),t.reject("loading-failed")}),t.promise()},getFlags:function(){return c},updateDependentSettings:function(e,t){e=e||c,e.showcase_vr&&(t.vr.enabled=!0)}}}).call(this,"/js/featureflags.js")},{"./util/ajax":10,"./util/logger":13,"./util/showcase":15}],6:[function(e,t,n){(function(t){"use strict";function n(){if(window.location.hash){var e=window.location.href.replace(/#model/i,"?m");return e=e.replace(/#m/i,"?m"),window.location.href=e,!0}return!1}function r(e){this.sid=e.sid,this.urlConfig=e.urlConfig,this.urls=new i(this.urlConfig.urlFiles),this.urls.init(),_.preconnect&&(this.prefetch(this.urlConfig.urlBase+"/api/v1/user/"),this.prefetch("http://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js"),this.preconnect("https://api.keen.io"),this.preconnect("https://api.mixpanel.com/track/"))}function o(e){var t=a.parseSidUrl(e);g.loadFeatureFlags(t).then(function(){v.init(g.getFlags()),v.preheat&&new r({sid:e,urlConfig:t}).init()})}var i=e("./util/ModelUrls"),a=e("./util/showcase"),s=e("./util/ajax"),u=e("./util/showcase"),c=e("./util/panorama"),l=e("./util/browser"),h=e("./util/logger"),f=e("./tile/TileUtils"),p=e("./util/cameraLight"),m=e("./constants"),d=e("./util/MathLight"),g=e("./featureflags"),v=e("./ab"),w=new h(t),_={quickstart:1===l.valueFromHash("qust",0)||1===l.valueFromHash("qs",0),tiles:1===l.valueFromHash("usetiles",0)||1===l.valueFromHash("tiles",0),preconnect:1===l.valueFromHash("precon",0)};if(r.prototype.init=function(){w.warn("PREHEATING");var e,t;return this.loadModelData().then(function(n){t=a.normalizeModeldata(n,d),_.quickstart&&(e=u.getHeroImage(t.images),e&&e.metadata&&e.metadata.scan_id&&$("<img/>").attr("src",e.thumbnail_signed_src).on("load",function(){$("#gui-thumb").css("backgroundImage","url("+e.thumbnail_signed_src+")").fadeIn(250).addClass("blur"),$(this).remove()}))}).then(this.urls.init.bind(this.urls)).then(function(){var e,n,r,o=t.camera_start;return o&&o.pano&&(e=_.tiles?this.loadTiledPanoTextures(t.camera_start,"high"):this.loadPanoTextures(t.camera_start.pano.uuid,"high")),v.preheatMesh&&(n=v.gzip?s.get(this.urls.get(t.job.uuid+"_50k.dam"),{responseType:"arraybuffer"}):s.get(this.urls.get(t.job.uuid+"_50k.dam.lzma"),{responseType:"arraybuffer"})),r=s.get(this.urls.get("vision.modeldata"),{responseType:"arraybuffer"}),$.when(r,e,n)}.bind(this)).then(function(){w.warn("DONE PREHEATING")})},r.prototype.loadModelData=function(){return s.get(this.urlConfig.urlModel,{responseType:"json",prefetchFrom:"model"})},r.prototype.loadPanoTextures=function(e,t){var n=c.getCubemapUrls(this.urls,e,t),r=n.map(function(e){return s.getImage(e)});return $.when(r[0],r[1],r[2],r[3],r[4],r[5])},r.prototype.loadTiledPanoTextures=function(e){var t=[],n=1024,r=new d.Matrix4,o=new d.Vector3(0,0,-1);r.makeRotationFromQuaternion(e.camera.quaternion),r.applyToVector3(o);var i=p.getHFOVFromVFov(m.insideFOV,window.innerWidth,window.innerHeight);f.matchingTilesInDirection(e.pano,n,o,i,t);var a=t.map(function(t){var n=this.urls.get("tiles/"+e.pano.uuid+"/1k_face"+t.face+"_"+t.tileX+"_"+t.tileY+".jpg");return s.getImage(n)}.bind(this));return $.when.apply($,a)},r.prototype.prefetch=function(e){var t=document.createElement("link");t.setAttribute("rel","prefetch"),t.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(t)},r.prototype.preconnect=function(e){var t=document.createElement("link");t.setAttribute("rel","preconnect"),t.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(t)},!n()){var E=a.getModelIDFromQueryString();E?o(E):w.warn("No sid, cannot preheat.")}}).call(this,"/js/preheater.js")},{"./ab":1,"./constants":2,"./featureflags":5,"./tile/TileUtils":7,"./util/MathLight":8,"./util/ModelUrls":9,"./util/ajax":10,"./util/browser":11,"./util/cameraLight":12,"./util/logger":13,"./util/panorama":14,"./util/showcase":15}],7:[function(e,t,n){"use strict";var r=e("../enum/GLCubeFaces"),o=e("../util/MathLight"),i={};i.TILE_SIZE=512,i.FACES_PER_PANO=6,i.LocationOnTile={Center:0,UpperLeft:1,UpperRight:2,LowerRight:3,LowerLeft:4},i.getTileVector=function(){return function(e,t,n,a,s,u,c,l){u=u||i.LocationOnTile.Center;var h=e/t,f=a/h;s=-s+(h-1);var p=s/h,m=t/e,d=2*m,g=d/2,v=2*f-1+g,w=2*p-1+g;switch(u){case i.LocationOnTile.UpperLeft:v-=g,w+=g,v+=c*d;break;case i.LocationOnTile.UpperRight:v+=g,w+=g,w-=c*d;break;case i.LocationOnTile.LowerRight:v+=g,w-=g,v-=c*d;break;case i.LocationOnTile.LowerLeft:v-=g,w-=g,w+=c*d;break;case i.LocationOnTile.Center:}switch(n){case r.GL_TEXTURE_CUBE_MAP_POSITIVE_X:o.setVector(l,-1,w,-v);break;case r.GL_TEXTURE_CUBE_MAP_NEGATIVE_X:o.setVector(l,1,w,v);break;case r.GL_TEXTURE_CUBE_MAP_POSITIVE_Y:o.setVector(l,-v,1,-w);break;case r.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:o.setVector(l,-v,-1,w);break;case r.GL_TEXTURE_CUBE_MAP_POSITIVE_Z:o.setVector(l,-v,w,1);break;case r.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:o.setVector(l,v,w,-1)}o.normalize(l)}}(),i.getFaceForTile=function(e,t){var n=i.TILE_SIZE;e<i.TILE_SIZE&&(n=e);var r=Math.floor(e/n),o=r*r;return Math.floor(t/o)},i.getTileLocation=function(e,t,n){var r=i.TILE_SIZE;e<i.TILE_SIZE&&(r=e);var o=i.getFaceForTile(e,t),a=Math.floor(e/r),s=a*a,u=t-o*s;n.tileX=u%a,n.tileY=Math.floor(u/a),n.face=o,n.faceTileIndex=u},i.getTileCountForSize=function(e){if(e<=i.TILE_SIZE)return i.FACES_PER_PANO;var t=Math.floor(e/i.TILE_SIZE),n=t*t,r=n*i.FACES_PER_PANO;return r},i.getRelativeDirection=function(){var e=new o.Matrix4,t=new o.Quaternion;return function(n,r){t.copy(n),t.inverse(),e.makeRotationFromQuaternion(t),e.applyToVector3(r),o.normalize(r)}}(),i.matchingTilesInDirection=function(){var e=new o.Vector3,t={face:-1,faceTileIndex:-1,tileX:-1,tileY:-1};new o.Vector3,new o.Vector3,new o.Matrix4;return function(n,r,a,s,u){s=Math.max(0,Math.min(s,360)),o.copyVector(a,e),i.getRelativeDirection(n.quaternion,e);for(var c=i.getTileCountForSize(r),l=r<i.TILE_SIZE?r:i.TILE_SIZE,h=0,f=0;c>f;f++)i.getTileLocation(r,f,t),i.isTileWithinFOV(r,l,t.face,t.tileX,t.tileY,e,s)&&(h++,u&&u.push({face:t.face,index:t.faceTileIndex,tileX:t.tileX,tileY:t.tileY}));return h}}(),i.isTileWithinFOV=function(){var e=new o.Vector3;return function(t,n,r,o,a,s,u){var c=i.mapFaceToCubemapFace(r);if(i.getTileVector(t,n,c,o,a,i.LocationOnTile.Center,0,e),i.isWithinFOV(e,s,u))return!0;for(var l=u/360,h=Math.floor(1/l),f=0,p=0;h>=p;p++){for(var m=i.LocationOnTile.UpperLeft;m<=i.LocationOnTile.LowerLeft;m++)if(i.getTileVector(t,n,c,o,a,m,f,e),i.isWithinFOV(e,s,u))return!0;f+=l}return!1}}(),i.isWithinFOV=function(){var e=Math.PI/180;return function(t,n,r){var i=r/2*e,a=Math.cos(i),s=o.dot(t,n);return s>=a}}(),i.mapFaceToCubemapFace=function(){var e={0:r.GL_TEXTURE_CUBE_MAP_POSITIVE_Y,1:r.GL_TEXTURE_CUBE_MAP_POSITIVE_Z,2:r.GL_TEXTURE_CUBE_MAP_POSITIVE_X,3:r.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z,4:r.GL_TEXTURE_CUBE_MAP_NEGATIVE_X,5:r.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y};return function(t){return e[t]}}(),t.exports=i},{"../enum/GLCubeFaces":3,"../util/MathLight":8}],8:[function(e,t,n){"use strict";var r={};r.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},r.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("MathLight.Matrix4: the constructor no longer reads arguments. use .set() instead.")},r.Matrix4.prototype={identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},applyToVector3:function(e){var t=e.x,n=e.y,r=e.z,o=this.elements;return e.x=o[0]*t+o[4]*n+o[8]*r+o[12],e.y=o[1]*t+o[5]*n+o[9]*r+o[13],e.z=o[2]*t+o[6]*n+o[10]*r+o[14],this},getInverse:function(e,t){var n=this.elements,r=e.elements,o=r[0],i=r[1],a=r[2],s=r[3],u=r[4],c=r[5],l=r[6],h=r[7],f=r[8],p=r[9],m=r[10],d=r[11],g=r[12],v=r[13],w=r[14],_=r[15],E=p*w*h-v*m*h+v*l*d-c*w*d-p*l*_+c*m*_,y=g*m*h-f*w*h-g*l*d+u*w*d+f*l*_-u*m*_,b=f*v*h-g*p*h+g*c*d-u*v*d-f*c*_+u*p*_,T=g*p*l-f*v*l-g*c*m+u*v*m+f*c*w-u*p*w,x=o*E+i*y+a*b+s*T;if(0===x){var F="MathLight.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(F);return console.warn(F),this.identity()}var A=1/x;return n[0]=E*A,n[1]=(v*m*s-p*w*s-v*a*d+i*w*d+p*a*_-i*m*_)*A,n[2]=(c*w*s-v*l*s+v*a*h-i*w*h-c*a*_+i*l*_)*A,n[3]=(p*l*s-c*m*s-p*a*h+i*m*h+c*a*d-i*l*d)*A,n[4]=y*A,n[5]=(f*w*s-g*m*s+g*a*d-o*w*d-f*a*_+o*m*_)*A,n[6]=(g*l*s-u*w*s-g*a*h+o*w*h+u*a*_-o*l*_)*A,n[7]=(u*m*s-f*l*s+f*a*h-o*m*h-u*a*d+o*l*d)*A,n[8]=b*A,n[9]=(g*p*s-f*v*s-g*i*d+o*v*d+f*i*_-o*p*_)*A,n[10]=(u*v*s-g*c*s+g*i*h-o*v*h-u*i*_+o*c*_)*A,n[11]=(f*c*s-u*p*s-f*i*h+o*p*h+u*i*d-o*c*d)*A,n[12]=T*A,n[13]=(f*v*a-g*p*a+g*i*m-o*v*m-f*i*w+o*p*w)*A,n[14]=(g*c*a-u*v*a-g*i*l+o*v*l+u*i*w-o*c*w)*A,n[15]=(u*p*a-f*c*a+f*i*l-o*p*l-u*i*m+o*c*m)*A,this},makeRotationFromQuaternion:function(e){var t=this.elements,n=e.x,r=e.y,o=e.z,i=e.w,a=n+n,s=r+r,u=o+o,c=n*a,l=n*s,h=n*u,f=r*s,p=r*u,m=o*u,d=i*a,g=i*s,v=i*u;return t[0]=1-(f+m),t[4]=l-v,t[8]=h+g,t[1]=l+v,t[5]=1-(c+m),t[9]=p-d,t[2]=h-g,t[6]=p+d,t[10]=1-(c+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},r.Quaternion=function(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==r?r:1},r.Quaternion.prototype={get x(){return this._x},set x(e){this._x=e},get y(){return this._y},set y(e){this._y=e},get z(){return this._z},set z(e){this._z=e},get w(){return this._w},set w(e){this._w=e},copy:function(e){this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w},inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this},multiply:function(e){return this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,o=e._z,i=e._w,a=t._x,s=t._y,u=t._z,c=t._w;return this._x=n*c+i*a+r*u-o*s,this._y=r*c+i*s+o*a-n*u,this._z=o*c+i*u+n*s-r*a,this._w=i*c-n*a-r*s-o*u,this}},r.convertWorkshopVector=function(e){return new r.Vector3(-e.x,e.y,e.z)},r.convertWorkshopQuaternion=function(e){return new r.Quaternion(-e.x,e.y,e.z,-e.w).multiply(new r.Quaternion(Math.sqrt(2)/2,Math.sqrt(2)/2,0,0))},r.normalize=function(e){var t=e.x*e.x+e.y*e.y+e.z*e.z,n=Math.sqrt(t);e.x/=n,e.y/=n,e.z/=n},r.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},r.setVector=function(e,t,n,r){e.x=t,e.y=n,e.z=r},r.copyVector=function(e,t){t.x=e.x,t.y=e.y,t.z=e.z},r.addVector=function(e,t){e.x+=t.x,e.y+=t.y,e.z+=t.z},r.subVector=function(e,t){e.x-=t.x,e.y-=t.y,e.z-=t.z},t.exports=r},{}],9:[function(e,t,n){(function(n){"use strict";function r(e){this.cache=null}function o(){this.baseUrl=null,this.cache=null}function i(){this.baseUrl=null}function a(e){this.initialLoadingPromise=null,this.endpoint=e+"?type=3",this.urlContainer=null,this.authorizationHeader=l.getAuthorizationHeader(),this.containerClasses=[i,o,r]}var s=e("./ajax"),u=e("./logger"),c=e("../constants"),l=e("./showcase"),h=new u(n);r.prototype={version:1,validate:function(e){return Object.keys(e).length>0},update:function(e){return this.cache=e,$.when()},get:function(e){return this.cache[e]}},o.prototype={version:2,validate:function(e){return"base.url"in e&&Object.keys(e).length>1},update:function(e){return this.baseUrl=e["base.url"],this.cache=e,$.when()},get:function(e){var t=this.cache[e];return t?this.baseUrl.replace("{{filename}}",e)+t:null}},i.prototype={version:3,validate:function(e){return e.templates&&e.catalog_file},update:function(e){var t=e.templates;return this.baseUrl=t[0],$.when()},get:function(e){return this.baseUrl.replace("{{filename}}",e)}},a.prototype={init:function(){return this.initialLoadingPromise?this.initialLoadingPromise:(setInterval(function(){h.debug("refreshing urls..."),this.refresh().done(function(){h.debug("refreshed")}).fail(function(){h.error("failed url refresh, urls might go stale soon")})}.bind(this),1e3*c.signedUrlRefreshRate),this.initialLoadingPromise=this.refresh(),this.initialLoadingPromise)},refresh:function(){return s.get(this.endpoint,{responseType:"json",prefetchFrom:"files",auth:this.authorizationHeader}).then(function(e){if(this.urlContainer&&this.urlContainer.validate(e))return this.urlContainer.update(e);for(var t=0;t<this.containerClasses.length;t++){var n=this.containerClasses[t],r=new n;if(r.validate(e))return h.info("Using urls version "+r.version),this.urlContainer=r,this.urlContainer.update(e)}return $.Deferred().reject("missing-urls")}.bind(this),function(e){return"loading-failed"})},get:function(e){return this.urlContainer.get(e)}},t.exports=a}).call(this,"/js/util/ModelUrls.js")},{"../constants":2,"./ajax":10,"./logger":13,"./showcase":15}],10:[function(e,t,n){(function(n){"use strict";function r(e,t,n){var r=new XMLHttpRequest;if(n&&"withCredentials"in r)r.open(e,t,n);else if("undefined"!=typeof XDomainRequest)r=new XDomainRequest,r.open(e,t);else{if(n)throw"Browser does not support CORS!";r.open(e,t)}return r}function o(e,t,n){function i(){u.warn("Retrying ",t),o(e,t,n).done(c.resolve.bind(c)).progress(c.notify.bind(c)).fail(c.reject.bind(c))}function a(e,t){var n=e.response;if("json"===t&&"object"!=typeof n)try{n=JSON.parse(e.responseText)}catch(r){return void c.reject({error:"Failed parsing JSON"})}else if("image/jpeg"===t){var o=new Uint8Array(e.response),i=new Blob([o],{type:"image/jpeg"}),a=URL.createObjectURL(i);n=new Image,n.src=a,n.crossOrigin="Anonymous",n.onload=function(){URL.revokeObjectURL(a)}}return n}var s=r(e,t,!1);if(n=n||{},n.retries=void 0!==n.retries?n.retries:0,n.retry=void 0!==n.retry?n.retry:"get"===e.toLowerCase(),n.responseType)if(["arraybuffer","text","json"].indexOf(n.responseType)>-1)s.responseType=n.responseType;else{if("image/jpeg"!==n.responseType)throw new Error('reponseType can only be one of "arraybuffer", "text" or "json", "image/jpeg"');s.responseType="arraybuffer"}"json"===n.responseType&&s.setRequestHeader("Accept","application/json"),n.auth&&s.setRequestHeader("Authorization",n.auth),"object"==typeof n.data&&(n.data=JSON.stringify(n.data),s.setRequestHeader("Content-Type","application/json"));var c=$.Deferred();return s.onreadystatechange=function(e){if(4==this.readyState)if(this.status>=500&&this.status<=600&&n.retry&&n.retries<3)n.retries++,setTimeout(i,1e3);else if(200==this.status){var t=a(this,n.responseType);c.resolve(t)}else c.reject(this)},s.onprogress=function(e){c.notify(e)},s.send(n.data),c.promise()}function i(e){return window.MP_REQUEST_CACHE?window.MP_REQUEST_CACHE[e]:null}function a(e,t){window.MP_REQUEST_CACHE&&(window.MP_REQUEST_CACHE[e]=t)}var s=e("./logger"),u=new s(n);window.URL=window.URL||window.webkitURL,window.MP_REQUEST_CACHE=window.MP_REQUEST_CACHE||{},window.MP_PREFETCHED_MODELDATA=window.MP_PREFETCHED_MODELDATA||{},setTimeout(function(){window.MP_REQUEST_CACHE=null,window.MP_PREFETCHED_MODELDATA={}},6e4),t.exports={get:function(e,t){var n=i(e);if(n)return n;var r;return r=t&&t.prefetchFrom&&window.MP_PREFETCHED_MODELDATA[t.prefetchFrom]?$.when(window.MP_PREFETCHED_MODELDATA[t.prefetchFrom]):o("GET",e,t),a(e,r),r},post:function(e,t){return o("POST",e,t)},patch:function(e,t){return o("PATCH",e,t)},getImage:function(e,t){function n(){u.warn("Retrying ",e),i.getImage(e,t+1).done(r.resolve.bind(r)).progress(r.notify.bind(r)).fail(r.reject.bind(r))}var r=$.Deferred(),o=new Image,i=this;return t=t||0,o.onerror=function(){3>t?setTimeout(n,1e3):r.reject()},o.onload=function(){r.resolve(o)},o.crossOrigin="anonymous",o.src=e,r}}}).call(this,"/js/util/ajax.js")},{"./logger":13}],11:[function(e,t,n){"use strict";function r(e,t){var n=window.navigator.userAgent,r=n.match(e);return r=r?r[1].split(t):[],{major:parseInt(r[0])||0,minor:parseInt(r[1])||0,patch:parseInt(r[2])||0}}var o=e("../exception/DeviceMismatchException");t.exports={isFullscreen:function(){return document.fullscreenElement||document.mozFullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},supportsFullscreen:function(){return document.fullscreenEnabled||document.mozFullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled},isPointerLocked:function(){return document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement},requestFullscreen:function(e,t){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen&&e.msRequestFullscreen(),t&&$(document).on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",browser.requestPointerLock)},requestPointerLock:function(){var e;if(document.fullscreenElement)e=document.fullscreenElement();else if(document.mozFullscreenElement)e=document.mozFullscreenElement();else if(document.mozFullScreenElement)e=document.mozFullScreenElement();else{if(!document.webkitFullscreenElement)return;e=document.webkitFullscreenElement()}e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock(),$(document).off("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",this)},exitPointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock()},exitFullscreen:function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},details:function(){var e=navigator.userAgent.match("(Firefox|Chrome|Safari)/([\\d]+)");return e?{name:e[1],version:parseInt(e[2]),platform:navigator.platform}:{}},is:function(e){return this.details()&&this.details().name===e},inIframe:function(){return window.parent!==window},aspectRatio:function(){var e=window.innerWidth/window.innerHeight;return isFinite(e)?e:0},userAgent:function(){return window.navigator.userAgent},isMobile:function(){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))},isSmallScreen:function(){var e=screen.width/window.devicePixelRatio;return 240>e},detectIE:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");return-1!==t||!!navigator.userAgent.match(/Trident.*rv\:11\./)},detectSafari:function(){var e=window.navigator.userAgent,t=e.indexOf("Safari");return-1!==t&&!this.detectChrome()},detectFirefox:function(){var e=window.navigator.userAgent;return-1!==e.indexOf("Firefox")},detectChrome:function(){var e=window.navigator.userAgent;return-1!==e.indexOf("Chrome")&&!this.detectOpera()},detectOpera:function(){var e=window.navigator.userAgent;return-1!==e.indexOf("OPR")},detectIOS:function(){var e=window.navigator.userAgent,t=/iPad|iPhone|iPod/;return t.test(e)},detectAndroid:function(){var e=window.navigator.userAgent;return-1!==e.indexOf("Android")},detectSamsungNative:function(){var e=window.navigator.userAgent;return-1!==e.indexOf("SM-G900H")||-1!==e.indexOf("GT-I9500")||-1!==e.indexOf("SM-N900")},detectSamsungS6:function(){var e=window.navigator.userAgent;return-1!==e.indexOf("SM-G92")},iosVersion:function(){if(!this.detectIOS())throw new o("Did not detect an iDevice");var e=/((?:\d+\_?){1,3}) like Mac OS/,t="_";return r(e,t)},androidVersion:function(){if(!this.detectAndroid())throw new o("Did not detect an Android based device");var e=/Android ((?:\d+\.?){1,3})/,t=".";return r(e,t)},valueFromCookie:function(e,t){var n=new RegExp(e+"=([0-9a-f]+)(; ?|$)").exec(document.cookie);if(!n)return t;var r=n[1];return"boolean"==typeof t?"true"===r||"1"===r:"number"==typeof t?parseFloat(r):r},valueFromHash:function(e,t){var n=new RegExp("[#&?]"+e+"=([^#&?]*)"),r=n.exec(window.location.href);if(!r)return t;var o=r[1];return"boolean"==typeof t?"true"===o||"1"===o:"number"==typeof t?parseFloat(o):window.decodeURIComponent(o)}}},{"../exception/DeviceMismatchException":4}],12:[function(e,t,n){"use strict";function r(e,t,n){return o(e.fov,t,n)}function o(e,t,n){var r=window.innerWidth,o=window.innerHeight,i=r*e/o;return i}t.exports={getHFOVForCamera:r,getHFOVFromVFov:o}},{}],13:[function(e,t,n){"use strict";function r(e){var t,n,i,a,s=e.split("/"),u="["+s[s.length-1].replace(".js","")+"]",c={};if(r.consoleEnabled){var l=function(e){$("#debug-console").append("<p>"+e+"</p>"),$("#debug-console")[0].scrollTop=$("#debug-console")[0].scrollHeight};t=function(e){l(Array.prototype.slice.call(arguments).join(" "))},n=function(e){l(Array.prototype.slice.call(arguments).join(" "))},i=function(e){l("WARN: "+Array.prototype.slice.call(arguments).join(" "))},a=function(e){l("ERROR: "+Array.prototype.slice.call(arguments).join(" "))}}else console.log?(t=console.log,n=console.info?console.info:console.log,i=console.warn?console.warn:console.log,a=console.error?console.error:console.log):t=n=i=a=function(){};var h=function(e){return[u,r.timestamp()].concat(Array.prototype.slice.call(e))},f=function(t,n){if(o){var i=Array.prototype.slice.call(t).join(" ");o.captureMessage(i,{level:n,path:e,timestamp:r.timestamp()})}},p=function(t,n){if(o){var i=Array.prototype.slice.call(t).join(" ");o.captureException(new Error(i),{level:n,path:e,timestamp:r.timestamp()})}};return{debug:function(){r.level>=r.levels.debug&&t.apply(console,h(arguments))},info:function(){r.level>=r.levels.info&&n.apply(console,h(arguments))},warn:function(){f(arguments,"warn"),r.level>=r.levels.warn&&i.apply(console,h(arguments))},error:function(){p(arguments,"error"),r.level>=r.levels.error&&a.apply(console,h(arguments))},v3str:function(e,t){var n=void 0===t?2:t;return"("+e.x.toPrecision(n)+", "+e.y.toPrecision(n)+", "+e.z.toPrecision(n)+")"},eulstr:function(e,t){var n=void 0===t?2:t;return"("+THREE.Math.radToDeg(e.x).toPrecision(n)+", "+THREE.Math.radToDeg(e.y).toPrecision(n)+", "+THREE.Math.radToDeg(e.z).toPrecision(n)+' "'+e.order+'")'},time:function(e){r.level>=r.levels.debug&&(c[e]=Date.now())},timeEnd:function(e){if(r.level>=r.levels.debug){var t=c[e];if(!t)return;var n=(Date.now()-t)/1e3;this.debug(e,n+"s")}}}}var o=window.Raven;r.timestamp=function(){return(Date.now()-window.navigationStart)/1e3+"s"},r.levels={debug:3,info:2,warn:1,error:0},r.level=r.levels.info,t.exports=r},{}],14:[function(e,t,n){"use strict";function r(e,t,n){return a.map(function(r,i){return e.get("pan/"+n+"/"+t+"_skybox"+o(r)+".jpg")}.bind(this))}function o(e){return s[e]}var i=e("../enum/GLCubeFaces"),a=[0,1,2,3,4,5],s={0:i.GL_TEXTURE_CUBE_MAP_POSITIVE_Y,1:i.GL_TEXTURE_CUBE_MAP_POSITIVE_Z,2:i.GL_TEXTURE_CUBE_MAP_POSITIVE_X,3:i.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z,4:i.GL_TEXTURE_CUBE_MAP_NEGATIVE_X,5:i.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y};t.exports={mapFaceToCubemapFace:o,getCubemapUrls:r}},{"../enum/GLCubeFaces":3}],15:[function(e,t,n){(function(n){"use strict";var r=e("./browser"),o=e("url"),i=e("./logger"),a=new i(n);t.exports={getAuthorizationHeader:function(){var e=r.valueFromHash("auth");if(e)return e.replace(","," ");var t=r.valueFromCookie("token");return t?"Token "+t:null},parseSidUrl:function(e){var t,n;if(e=e||"",e.match(/^https?/)){var r=o.parse(e);t=r.protocol+"//"+r.host,n=e}else t=window.location.protocol+"//"+window.location.host,n=t+"/api/player/models/"+e;return{urlBase:t,urlModel:n,urlFiles:n+(n.match(/\/$/)?"files":"/files"),urlThumb:n+(n.match(/\/$/)?"thumb":"/thumb")}},getModelIDFromQueryString:function(){return r.valueFromHash("model")||r.valueFromHash("m")},getHeroImage:function(e){for(var t=0;t<e.length;t++)if(e[t].is_hero)return e[t];return null},normalizeModeldata:function(e,t){e=JSON.parse(JSON.stringify(e)),e.images.forEach(function(e){if(e.metadata&&"string"==typeof e.metadata)try{e.metadata=JSON.parse(e.metadata)}catch(n){a.warn("Unable to parse image metadata"),e.metadata=null}else"object"==typeof e.metadata&&a.debug("image.metadata already a JSON object");e.metadata&&e.metadata.camera_quaternion&&(e.metadata.camera_quaternion=t.convertWorkshopQuaternion(e.metadata.camera_quaternion)),e.metadata&&e.metadata.camera_position&&(e.metadata.camera_position=t.convertWorkshopVector(e.metadata.camera_position))});var n=e.camera_start;return n&&(n.pano&&(n.pano.quaternion=t.convertWorkshopQuaternion(n.pano.quaternion),n.pano.position=t.convertWorkshopVector(n.pano.position)),n.camera.quaternion=t.convertWorkshopQuaternion(n.camera.quaternion),n.camera.position=t.convertWorkshopVector(n.camera.position)),e}}}).call(this,"/js/util/showcase.js")},{"./browser":11,"./logger":13,url:20}],16:[function(e,t,n){(function(e){!function(r){function o(e){throw new RangeError(U[e])}function i(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function a(e,t){var n=e.split("@"),r="";n.length>1&&(r=n[0]+"@",e=n[1]),e=e.replace(k,".");var o=e.split("."),a=i(o,t).join(".");return r+a}function s(e){for(var t,n,r=[],o=0,i=e.length;i>o;)t=e.charCodeAt(o++),t>=55296&&56319>=t&&i>o?(n=e.charCodeAt(o++),56320==(64512&n)?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),o--)):r.push(t);return r}function u(e){return i(e,function(e){var t="";return e>65535&&(e-=65536,t+=M(e>>>10&1023|55296),e=56320|1023&e),t+=M(e)}).join("")}function c(e){return 10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:b}function l(e,t){return e+22+75*(26>e)-((0!=t)<<5)}function h(e,t,n){var r=0;for(e=n?R(e/A):e>>1,e+=R(e/t);e>P*x>>1;r+=b)e=R(e/P);return R(r+(P+1)*e/(e+F))}function f(e){var t,n,r,i,a,s,l,f,p,m,d=[],g=e.length,v=0,w=j,_=O;for(n=e.lastIndexOf(C),0>n&&(n=0),r=0;n>r;++r)e.charCodeAt(r)>=128&&o("not-basic"),d.push(e.charCodeAt(r));for(i=n>0?n+1:0;g>i;){for(a=v,s=1,l=b;i>=g&&o("invalid-input"),f=c(e.charCodeAt(i++)),(f>=b||f>R((y-v)/s))&&o("overflow"),v+=f*s,p=_>=l?T:l>=_+x?x:l-_,!(p>f);l+=b)m=b-p,s>R(y/m)&&o("overflow"),s*=m;t=d.length+1,_=h(v-a,t,0==a),R(v/t)>y-w&&o("overflow"),w+=R(v/t),v%=t,d.splice(v++,0,w)}return u(d)}function p(e){var t,n,r,i,a,u,c,f,p,m,d,g,v,w,_,E=[];for(e=s(e),g=e.length,t=j,n=0,a=O,u=0;g>u;++u)d=e[u],128>d&&E.push(M(d));for(r=i=E.length,i&&E.push(C);g>r;){for(c=y,u=0;g>u;++u)d=e[u],d>=t&&c>d&&(c=d);for(v=r+1,c-t>R((y-n)/v)&&o("overflow"),n+=(c-t)*v,t=c,u=0;g>u;++u)if(d=e[u],t>d&&++n>y&&o("overflow"),d==t){for(f=n,p=b;m=a>=p?T:p>=a+x?x:p-a,!(m>f);p+=b)_=f-m,w=b-m,E.push(M(l(m+_%w,0))),f=R(_/w);E.push(M(l(f,0))),a=h(n,v,r==i),n=0,++r}++n,++t}return E.join("")}function m(e){return a(e,function(e){return L.test(e)?f(e.slice(4).toLowerCase()):e})}function d(e){return a(e,function(e){return I.test(e)?"xn--"+p(e):e})}var g="object"==typeof n&&n&&!n.nodeType&&n,v="object"==typeof t&&t&&!t.nodeType&&t,w="object"==typeof e&&e;(w.global===w||w.window===w||w.self===w)&&(r=w);var _,E,y=2147483647,b=36,T=1,x=26,F=38,A=700,O=72,j=128,C="-",L=/^xn--/,I=/[^\x20-\x7E]/,k=/[\x2E\u3002\uFF0E\uFF61]/g,U={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},P=b-T,R=Math.floor,M=String.fromCharCode;if(_={version:"1.4.1",ucs2:{decode:s,encode:u},decode:f,encode:p,toASCII:d,toUnicode:m},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return _});else if(g&&v)if(t.exports==g)v.exports=_;else for(E in _)_.hasOwnProperty(E)&&(g[E]=_[E]);else r.punycode=_}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],17:[function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,i){
t=t||"&",n=n||"=";var a={};if("string"!=typeof e||0===e.length)return a;var s=/\+/g;e=e.split(t);var u=1e3;i&&"number"==typeof i.maxKeys&&(u=i.maxKeys);var c=e.length;u>0&&c>u&&(c=u);for(var l=0;c>l;++l){var h,f,p,m,d=e[l].replace(s,"%20"),g=d.indexOf(n);g>=0?(h=d.substr(0,g),f=d.substr(g+1)):(h=d,f=""),p=decodeURIComponent(h),m=decodeURIComponent(f),r(a,p)?o(a[p])?a[p].push(m):a[p]=[a[p],m]:a[p]=m}return a};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],18:[function(e,t,n){"use strict";function r(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var o=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?r(a(e),function(a){var s=encodeURIComponent(o(a))+n;return i(e[a])?r(e[a],function(e){return s+encodeURIComponent(o(e))}).join(t):s+encodeURIComponent(o(e[a]))}).join(t):s?encodeURIComponent(o(s))+n+encodeURIComponent(o(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],19:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":17,"./encode":18}],20:[function(e,t,n){"use strict";function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function o(e,t,n){if(e&&c.isObject(e)&&e instanceof r)return e;var o=new r;return o.parse(e,t,n),o}function i(e){return c.isString(e)&&(e=o(e)),e instanceof r?e.format():r.prototype.format.call(e)}function a(e,t){return o(e,!1,!0).resolve(t)}function s(e,t){return e?o(e,!1,!0).resolveObject(t):t}var u=e("punycode"),c=e("./util");n.parse=o,n.resolve=a,n.resolveObject=s,n.format=i,n.Url=r;var l=/^([a-z0-9.+-]+:)/i,h=/:[0-9]*$/,f=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,p=["<",">",'"',"`"," ","\r","\n","	"],m=["{","}","|","\\","^","`"].concat(p),d=["'"].concat(m),g=["%","/","?",";","#"].concat(d),v=["/","?","#"],w=255,_=/^[+a-z0-9A-Z_-]{0,63}$/,E=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,y={javascript:!0,"javascript:":!0},b={javascript:!0,"javascript:":!0},T={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},x=e("querystring");r.prototype.parse=function(e,t,n){if(!c.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),o=-1!==r&&r<e.indexOf("#")?"?":"#",i=e.split(o),a=/\\/g;i[0]=i[0].replace(a,"/"),e=i.join(o);var s=e;if(s=s.trim(),!n&&1===e.split("#").length){var h=f.exec(s);if(h)return this.path=s,this.href=s,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=x.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var p=l.exec(s);if(p){p=p[0];var m=p.toLowerCase();this.protocol=m,s=s.substr(p.length)}if(n||p||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var F="//"===s.substr(0,2);!F||p&&b[p]||(s=s.substr(2),this.slashes=!0)}if(!b[p]&&(F||p&&!T[p])){for(var A=-1,O=0;O<v.length;O++){var j=s.indexOf(v[O]);-1!==j&&(-1===A||A>j)&&(A=j)}var C,L;L=-1===A?s.lastIndexOf("@"):s.lastIndexOf("@",A),-1!==L&&(C=s.slice(0,L),s=s.slice(L+1),this.auth=decodeURIComponent(C)),A=-1;for(var O=0;O<g.length;O++){var j=s.indexOf(g[O]);-1!==j&&(-1===A||A>j)&&(A=j)}-1===A&&(A=s.length),this.host=s.slice(0,A),s=s.slice(A),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var k=this.hostname.split(/\./),O=0,U=k.length;U>O;O++){var P=k[O];if(P&&!P.match(_)){for(var R="",M=0,z=P.length;z>M;M++)R+=P.charCodeAt(M)>127?"x":P[M];if(!R.match(_)){var S=k.slice(0,O),q=k.slice(O+1),V=P.match(E);V&&(S.push(V[1]),q.unshift(V[2])),q.length&&(s="/"+q.join(".")+s),this.hostname=S.join(".");break}}}this.hostname.length>w?this.hostname="":this.hostname=this.hostname.toLowerCase(),I||(this.hostname=u.toASCII(this.hostname));var H=this.port?":"+this.port:"",D=this.hostname||"";this.host=D+H,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!y[m])for(var O=0,U=d.length;U>O;O++){var G=d[O];if(-1!==s.indexOf(G)){var N=encodeURIComponent(G);N===G&&(N=escape(G)),s=s.split(G).join(N)}}var X=s.indexOf("#");-1!==X&&(this.hash=s.substr(X),s=s.slice(0,X));var B=s.indexOf("?");if(-1!==B?(this.search=s.substr(B),this.query=s.substr(B+1),t&&(this.query=x.parse(this.query)),s=s.slice(0,B)):t&&(this.search="",this.query={}),s&&(this.pathname=s),T[m]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var H=this.pathname||"",$=this.search||"";this.path=H+$}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,i="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&c.isObject(this.query)&&Object.keys(this.query).length&&(i=x.stringify(this.query));var a=this.search||i&&"?"+i||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||T[t])&&o!==!1?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),a=a.replace("#","%23"),t+o+n+a+r},r.prototype.resolve=function(e){return this.resolveObject(o(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if(c.isString(e)){var t=new r;t.parse(e,!1,!0),e=t}for(var n=new r,o=Object.keys(this),i=0;i<o.length;i++){var a=o[i];n[a]=this[a]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),u=0;u<s.length;u++){var l=s[u];"protocol"!==l&&(n[l]=e[l])}return T[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!T[e.protocol]){for(var h=Object.keys(e),f=0;f<h.length;f++){var p=h[f];n[p]=e[p]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||b[e.protocol])n.pathname=e.pathname;else{for(var m=(e.pathname||"").split("/");m.length&&!(e.host=m.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==m[0]&&m.unshift(""),m.length<2&&m.unshift(""),n.pathname=m.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var d=n.pathname||"",g=n.search||"";n.path=d+g}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var v=n.pathname&&"/"===n.pathname.charAt(0),w=e.host||e.pathname&&"/"===e.pathname.charAt(0),_=w||v||n.host&&e.pathname,E=_,y=n.pathname&&n.pathname.split("/")||[],m=e.pathname&&e.pathname.split("/")||[],x=n.protocol&&!T[n.protocol];if(x&&(n.hostname="",n.port=null,n.host&&(""===y[0]?y[0]=n.host:y.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===m[0]?m[0]=e.host:m.unshift(e.host)),e.host=null),_=_&&(""===m[0]||""===y[0])),w)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,y=m;else if(m.length)y||(y=[]),y.pop(),y=y.concat(m),n.search=e.search,n.query=e.query;else if(!c.isNullOrUndefined(e.search)){if(x){n.hostname=n.host=y.shift();var F=n.host&&n.host.indexOf("@")>0?n.host.split("@"):!1;F&&(n.auth=F.shift(),n.host=n.hostname=F.shift())}return n.search=e.search,n.query=e.query,c.isNull(n.pathname)&&c.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!y.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var A=y.slice(-1)[0],O=(n.host||e.host||y.length>1)&&("."===A||".."===A)||""===A,j=0,C=y.length;C>=0;C--)A=y[C],"."===A?y.splice(C,1):".."===A?(y.splice(C,1),j++):j&&(y.splice(C,1),j--);if(!_&&!E)for(;j--;j)y.unshift("..");!_||""===y[0]||y[0]&&"/"===y[0].charAt(0)||y.unshift(""),O&&"/"!==y.join("/").substr(-1)&&y.push("");var L=""===y[0]||y[0]&&"/"===y[0].charAt(0);if(x){n.hostname=n.host=L?"":y.length?y.shift():"";var F=n.host&&n.host.indexOf("@")>0?n.host.split("@"):!1;F&&(n.auth=F.shift(),n.host=n.hostname=F.shift())}return _=_||n.host&&y.length,_&&!L&&y.unshift(""),y.length?n.pathname=y.join("/"):(n.pathname=null,n.path=null),c.isNull(n.pathname)&&c.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var e=this.host,t=h.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{"./util":21,punycode:16,querystring:19}],21:[function(e,t,n){"use strict";t.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},{}]},{},[6]);